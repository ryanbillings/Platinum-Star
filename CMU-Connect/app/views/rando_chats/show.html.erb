<%= stylesheet_link_tag "tokbox_layout", :media => "all" %>
<%= javascript_include_tag "tokbox_layout" %>
<div id = "nextdiv">
  <p>
    <h2>You're chat just ended. How did you like it?</h2>
		<%= link_to :roulette do %>
			<div class="afterchat-button">
				<h3>Good, send them my Info!</h3>
				<%= image_tag('yes.png')%> 
			</div>
		<% end %>
		
		<%= link_to :roulette do %>
			<div class="afterchat-button">
				<h3>Please don't disclose my info</h3>
				<%= image_tag('no.png')%> 
			</div>
		<% end %>
		
		<%= link_to :roulette do %>
			<div class="afterchat-button">
				<h3>Report inappropriate behavior</h3>
				<%= image_tag('report.png')%> 
			</div>
		<% end %>
  </p>
</div>

<div id = "disconnectdiv">
  <p>
    <h2>You're chat just ended. How did you like it?</h2>
		<%= link_to :messages do %>
			<div class="afterchat-button">
				<h3>Good, send them my Info!</h3>
				<%= image_tag('yes.png')%> 
			</div>
		<% end %>
		
		<%= link_to :messages do %>
			<div class="afterchat-button">
				<h3>Please don't disclose my info</h3>
				<%= image_tag('no.png')%> 
			</div>
		<% end %>
		
		<%= link_to :messages do %>
			<div class="afterchat-button">
				<h3>Report inappropriate behavior</h3>
				<%= image_tag('report.png')%> 
			</div>
		<% end %>
  </p>
</div>

<div id = "rando_content">
	
<h1>Welcome to Random Social Chat!</h1>

		<div id="videobox">
			<h2>You:</h2>

	<script src="http://staging.tokbox.com/v0.91/js/TB.min.js"></script>
	<script type="text/javascript">
	        var apiKey = 11368202; 
	        var sessionId = "<%= @rando_chat.sessionId %>"; 
	        var token = "<%= @tok_token %>"; 


	        var session = TB.initSession(sessionId);
	        TB.addEventListener('exception', exceptionHandler);

	        //Video chat event listeners
	        session.addEventListener('sessionConnected', sessionConnectedHandler);
	        session.addEventListener('streamCreated', streamCreatedHandler);
	        session.addEventListener('streamDestroyed', streamDestroyedHandler);

	        session.connect(apiKey,token);

	   	function disconnect() {
		  session.disconnect();
	          session.cleanup();
			document.getElementById('disconnectdiv').style.display = 'block';
	          document.getElementById('rando_content').style.display = 'none';
		}
  
	        function next() {
	          session.disconnect();
			  session.cleanup();
	          document.getElementById('nextdiv').style.display = 'block';
	          document.getElementById('rando_content').style.display = 'none';
	        }
	</script>
	  
</div>
<div id="randochat-options">
	<a href = "#" onclick="disconnect()">
		<img src="/assets/icons/glyphicons_197_remove.png"/><br/>
	     Disconnect
	</a>

	<a href = "#" onclick="next()">
		<img src="/assets/icons/glyphicons_211_right_arrow.png"/><br/>
	    Next
	</a>
	<a href = "#">
		<img src="/assets/icons/glyphicons_199_ban.png"/> <br/>
	    Report to Admin
	</a>
</div>
